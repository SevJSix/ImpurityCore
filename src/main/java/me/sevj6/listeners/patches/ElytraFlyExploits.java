package me.sevj6.listeners.patches;

import me.sevj6.Instance;
import me.sevj6.util.ViolationManager;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.entity.EntityToggleGlideEvent;
import org.bukkit.inventory.ItemStack;

public class ElytraFlyExploits extends ViolationManager implements Listener, Instance {

    public ElytraFlyExploits() {
        super(1, 3);
    }

    @EventHandler
    public void onToggle(EntityToggleGlideEvent event) {
        if (event.getEntity() instanceof Player) {
            Player player = (Player) event.getEntity();
            if (config.getBoolean("Exploits.future-packet-elytrafly-patch")) {
                increment(player.getUniqueId());
                if (getVLS(player.getUniqueId()) > 25) {
                    remove(player.getUniqueId());
                    ItemStack chest = player.getInventory().getChestplate();
                    if (chest != null) {
                        player.getInventory().setChestplate(null);
                        if (player.getInventory().firstEmpty() != -1) {
                            player.getInventory().addItem(chest);
                        } else {
                            player.getWorld().dropItemNaturally(player.getLocation(), chest);
                        }
                    }
                }
            }
            if (config.getBoolean("NetherRoofNoElytra.Enabled")) {
                if (player.getWorld().getName().equalsIgnoreCase("world_nether")) {
                    if (player.getLocation().getY() < 0 || player.getLocation().getY() > 127) event.setCancelled(true);
                }
            }
        }
    }
}
