package me.sevj6.listeners.patches;

import me.sevj6.Instance;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.entity.EntityDamageByEntityEvent;
import org.bukkit.event.inventory.InventoryType;

public class PVPExploits implements Listener, Instance {

    @EventHandler
    public void onDamage(EntityDamageByEntityEvent event) {
        if (event.getDamager() instanceof Player) {
            Player player = (Player) event.getDamager();

            // free roam patch
            if (checkDmg(event.getDamage()) && player.getOpenInventory().getType() != InventoryType.HOPPER) {
                event.setCancelled(true);
                return;
            }

            //32k wasp patch
            if (player.isGliding() && checkDmg(event.getDamage())) {
                event.setCancelled(true);
                player.closeInventory();
                player.setGliding(false);
                return;
            }

            //32ktp patch
            if (event.getEntity().getLocation().distance(player.getOpenInventory().getBottomInventory().getLocation()) > 8) {
                event.setCancelled(true);
                player.closeInventory();
            }

        }
    }

    private boolean checkDmg(double d) {
        return d > 100;
    }
}
